{% extends "layouts/main.html" %}
{% from "components/service-header/macro.njk" import serviceHeader %}
{% set pageName = "Edit autocomplete question - Apply for a county parish holding number in England" %}
{% set headingPlaceholder = "Page heading" %}
{% set guidancePlaceholder = "" %}
{#  #}

{% block header %}

{#
<style>

  .dxt-announcement-bar {
    background: #fc0;
    text-align: center;
    padding:0.5rem;
  }

  .dxt-announcement-bar p {
    margin: 0;
  }

</style>

<div class="dxt-announcement-bar" role="region" aria-live="polite" aria-label="Announcement">
    <p class="govuk-body">Status update goes in here</p>
</div>
#}


  {{ serviceHeader({
    organisationName: "Defra",
    productName: "Forms Designer",
    serviceName: "",
    containerClasses: containerClasses,
    accountName: "Chris Smith",
    homepageLink: "/",
    signOutLink: "/onboarding/sign-out-confirmation",
    navigationItems: [
      { href: "/library.html", text: "Forms library", id: "nav-library" },
      { href: "/cph-overview/draft/complete-clean.html", text: "Overview", id: "nav-overview" },
      { href: "/redesigntest/listing", text: "Editor", id: "nav-editor" }    ],
    activeLinkId: "nav-editor"
  }) }}

<div class="x-govuk-masthead x-govuk-masthead--large">
  <div class="govuk-width-container">
{{ govukBackLink({ classes: "govuk-back-link--inverse govuk-!-margin-bottom-0", text: "Back to add
    and edit pages", href: "/redesigntest/listing.html" }) }}

    <hr
      class="govuk-section-break govuk-section-break--m govuk-section-break--visible"
      style="border-bottom: 1px solid white; margin-bottom: 0"
    />

    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds-from-desktop">
        <h1 class="x-govuk-masthead__title">
          <span class="govuk-caption-l" style="color: white"
            >Apply for a county parish holding certificate</span
          >
          Edit page 2
        </h1>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block content %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <div class="govuk-grid-row">
      <!-- Left Column for Form Controls -->
      <div class="govuk-grid-column-one-half-from-desktop" id="container" style="flex: 1 1 75%; overflow-y: auto">
        <div class="govuk-summary-card govuk-!-margin-top-0" style="border-left: 10px solid #008938">
          <div class="govuk-summary-card__content govuk-!-padding-top-0" style="background-color: #f3f2f1">

            <dl class="govuk-summary-list">
              <div class="govuk-summary-list__row">
                <dd class="govuk-summary-list__value">
                  <!-- Dynamic Summary List -->

                  <!-- Question Settings Container -->
                  <div class="govuk-grid-row" id="page-settings-container-1">
                    <div id="question-1">
                      <div class="govuk-summary-card__content" style="margin-bottom: 0">
                        <!-- Sub Navigation for Question -->
                        <nav class="moj-sub-navigation govuk-!-padding-top-0 govuk-!-margin-bottom-2 "
                          aria-label="Sub navigation">
                          <ul class="moj-sub-navigation__list" id="nav-list2">
                            <!-- Question Link -->
                            <li class="moj-sub-navigation__item">
                              <a class="moj-sub-navigation__link" href="#question-1">Page settings</a>
                            </li>

                            {# <li class="moj-sub-navigation__item">
                              <a class="moj-sub-navigation__link" href="#overview-noquestions">Overview of questions</a>
                            </li> #}

                            <li class="moj-sub-navigation__item">
                              <a class="moj-sub-navigation__link" aria-current="page"
                                href="#question-1-information-type">Question 11</a>
                            </li>
                          </ul>
                        </nav>

                        <div class="govuk-summary-card__title-wrapper govuk-!-padding-top-0"></div>

                        <span class="govuk-caption-l">Page 2</span>
                        <h2 class="govuk-heading-l">Question 11</h2>

                        <form method="post" id="options-form" action="/redesigntest/templates/more-than-1-question/autocomplete/overview">

                          {% from "govuk/components/input/macro.njk" import govukInput %}

                          {{ govukInput({
                            label: {
                              text: "Question",
                              classes: "govuk-label--m",
                              isPageHeading: false
                            },
                            id: "multi-question-label-input-autocomplete",
                            value: data['multi-question-label-input-autocomplete'],
                            name: "multiQuestionLabelInputAutocomplete"
                          }) }}

                       <!-- Hint Textarea Element -->
{{ govukTextarea({
  label: {
    text: "Hint text (optional)",
    classes: "govuk-label--m"
  },
  id: "multi-question-hint-text-input-autocomplete",
  name: "multiQuestionHintTextInputAutocomplete",
  value: data['multi-question-hint-text-input-autocomplete'],
  classes: "govuk-textarea",
  rows: 3,
  describedBy: "multi-question-listPreview-hint"
}) }}




                          <!-- List config -->

                          <div class="govuk-form-group">
                            <h2 class="govuk-heading-m moj-add-another__heading" tabindex="-1">Create and edit your list of autocomplete options</h2>

                            <!-- autocomplete -->

                            <div class="govuk-form-group">
                              <label class="govuk-label" for="csv-input">
                                Enter options separated by a comma. For example, option 1, option 2, option 3
                              </label>
                              <textarea id="csv-input" class="govuk-textarea" rows="10"></textarea>
                              <div id="options-entry"></div>
                            </div>

                            <!-- autocomplete -->

                            <!-- Make Optional Checkbox -->
                            <div class="govuk-form-group">
                              <div class="govuk-checkboxes--small">
                                <div class="govuk-checkboxes__item">
                                  <input
                                    class="govuk-checkboxes__input"
                                    type="checkbox"
                                    id="makeOptional"
                                    name="makeOptional"
                                    value="{{ data['optional-label-q1'] }}"
                                  >
                                  <label class="govuk-label govuk-checkboxes__label" for="makeOptional">
                                    Make this question optional
                                  </label>
                                </div>
                              </div>
                            </div>

    <!-- Error Message Input -->
    {{ govukInput({
      label: {
        text: "Short description for error messages",
        classes: "govuk-label--m",
        isPageHeading: false
      },
      hint: {
        text: "Enter a short description for this question like ‘date of birth’. Short descriptions are used in error messages, for example ‘Enter a valid date of birth’"
      },
      id: "error-message-input",
      name: "errorMessageInput"
    }) }}




                            <div id="summary-container">
                              <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">

                              <!-- The dynamic summary list will be populated here -->
                              <h2 class="govuk-heading-m">Question settings</h2>

                              {{ govukSummaryList({
                                classes: "govuk-summary-list govuk-section-break govuk-section-break--visible govuk-!-margin-bottom-6",
                                rows: [
                                  {
                                    key: { text: "Type of information" },
                                    value: { html: "List: autocomplete" },
                                    actions: {
                                      items: [
                                        {
                                          href: "/redesigntest/templates/1-question/information-type.html",
                                          text: "Change",
                                          visuallyHiddenText: "name"
                                        }
                                      ]
                                    }
                                  }
                                ]
                              }) }}
                            </div>
                            <div class="moj-button-action">
                              {{ govukButton({
                                text: 'Continue',
                                type: 'submit'
                              }) }}
                            </div>
                          </div>
                        </form>
                      </div>
                    </div>
                  </div>
                </dd>
              </div>
            </dl>
          </div>
        </div>
      </div>


  <!-- Right Column for Preview -->
  <div class="govuk-grid-column-one-half-from-desktop" id="second-container" style="outline: solid 1px #008938; height: 100vh;overflow-y: auto; position: sticky; top: 0; padding: 20px; box-shadow: 5px 10px #008938;">
    <!-- Before content -->
    <div id="before-content">
      <p class="govuk-body-s" style="margin-bottom: 0">
        <a href="#" class="govuk-link govuk-link--no-visited-state" rel="noreferrer noopener" target="_blank">Preview
          this page in a new tab</a>
      </p>
    </div>

    {% include "/redesigntest/templates/previews-more-than-1-question/textarea/overview.html" %}
    {% include "/redesigntest/templates/previews-more-than-1-question/numbers/for-overview.html" %}
    {% include "/redesigntest/templates/previews-more-than-1-question/date/for-overview.html" %}

    {% include "/redesigntest/templates/previews-more-than-1-question/address/for-overview.html" %}

    {% include "/redesigntest/templates/previews-more-than-1-question/phone/for-overview.html" %}

    {# {% include "/redesigntest/templates/previews-more-than-1-question/fileupload/for-overview.html" %} #}

    {% include "/redesigntest/templates/previews-more-than-1-question/email/for-overview.html" %}

    {% include "/redesigntest/templates/more-than-1-question/previews/yesno.html" %}


    <!-- Include the preview template -->
    {% include "/redesigntest/templates/previews-more-than-1-question/autocomplete/edit.html" %}


    <script src="https://unpkg.com/accessible-autocomplete@2.0.4/dist/accessible-autocomplete.min.js"></script>

    <script>

      // Process CSV and create an array of options
      function processCSV(csvText) {
        return csvText
          .split(",")
          .map((option) => option.trim())
          .filter((option) => option.length > 0); // Ensures no empty options
      }

      // Initialise or reinitialise the autocomplete
      function initialiseAutocomplete(options) {
        // Clear the container before reinitializing
        const container = document.querySelector("#autocomplete-container");
        container.innerHTML = "";

        // Initialise the accessible autocomplete with the given options
        accessibleAutocomplete({
          element: container,
          id: "autocomplete-input", // To match it to the label
          source: options
        });

        // Update a status label with a green check emoji if CSV has been successfully parsed
        const label = document.getElementById("options-entry");
        if (options.length > 0) {
          label.innerHTML = "Preview updated (CSV Imported ✅)";
        } else {
          label.innerHTML = ""; // Reset label if no options
        }
      }

      // initialise the autocomplete with an empty array initially
      initialiseAutocomplete([]);

      // Event listener for changes in the textarea
      document.getElementById("csv-input").addEventListener("input", function () {
        // Get CSV input from textarea
        const csvInput = this.value;

        // Process the CSV and get options
        const options = processCSV(csvInput);

        // Reinitialise the autocomplete with the new options
        initialiseAutocomplete(options);
      });


    </script>

  </div>
</div>
<!-- Consolidated Script for Updating and Highlighting with Placeholder -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Utility function to set text content with a default value
    function setTextContent(element, value, defaultValue = '') {
      if (element) {
        element.textContent = value || defaultValue;
      }
    }

    // Function to apply focus/blur highlights to inputs and their corresponding targets
    function applyHighlightOnFocus(inputElement, targetElement) {
      if (inputElement && targetElement) {
        inputElement.addEventListener('focus', () => targetElement.classList.add('highlight'));
        inputElement.addEventListener('blur', () => targetElement.classList.remove('highlight'));

        // If input is already focused, apply the highlight immediately
        if (document.activeElement === inputElement) {
          targetElement.classList.add('highlight');
        }
      }
    }

    // Handler for updating the <h1> based on input
    function handleQuestionInput(input, output, defaultText = 'Question') {
      if (input && output) {
        // Function to update the <h1> text
        function updateHeading() {
          output.textContent = input.value.trim() || defaultText;
        }

        // Event listeners for input events
        input.addEventListener('input', updateHeading);
        input.addEventListener('focus', () => output.classList.add('highlight'));
        input.addEventListener('blur', () => output.classList.remove('highlight'));

        // Initialize the <h1> with default or existing input value
        updateHeading();
      }
    }

    // Handler for updating the <div> based on textarea with placeholder logic
    function handleHintInput(textarea, output, placeholderText = 'Hint text') {
      if (textarea && output) {
        // Function to update the <div> text
        function updateHint() {
          if (textarea.value.trim()) {
            output.textContent = textarea.value.trim();
            output.classList.remove('placeholder'); // Remove placeholder styling if any
          } else if (document.activeElement === textarea) {
            // If textarea is focused and empty, show placeholder
            output.textContent = placeholderText;
            output.classList.add('placeholder'); // Add placeholder styling
          } else {
            // If textarea is not focused and empty, clear the output
            output.textContent = '';
            output.classList.remove('placeholder'); // Remove placeholder styling
          }
        }

        // Event listeners for textarea events
        textarea.addEventListener('input', updateHint);
        textarea.addEventListener('focus', updateHint);
        textarea.addEventListener('blur', updateHint);

        // Initialize the <div> with default or existing textarea value
        updateHint();
      }
    }

    // Select DOM elements for Question
    const questionInput = document.getElementById('multi-question-label-input-autocomplete');
    const questionOutput = document.getElementById('multi-question-label-output-autocomplete');

    // Select DOM elements for Hint Text
    const hintTextarea = document.getElementById('multi-question-hint-text-input-autocomplete');
    const hintOutput = document.getElementById('multi-question-listPreview-hint');

    // Initialize handlers
    handleQuestionInput(questionInput, questionOutput, 'Question');
    handleHintInput(hintTextarea, hintOutput, 'Hint text');

    // Apply highlight functionality
    applyHighlightOnFocus(questionInput, questionOutput);
    applyHighlightOnFocus(hintTextarea, hintOutput);

    // If you have more input-output pairs, initialize them similarly here
    // Example:
    /*
    const anotherInput = document.getElementById('multi-question-another-input-id');
    const anotherOutput = document.getElementById('multi-question-another-output-id');
    handleAnotherInputHandler(anotherInput, anotherOutput, 'Default Text');
    applyHighlightOnFocus(anotherInput, anotherOutput);
    */
  });
</script>







<style>


  .highlight {
    background-color: #ffe5cc;
    border-bottom: 2px solid #ffb266;
  }



  #before-content {
    position: absolute;
    top: 0;
    left: 10 !important;
    right: 0;
    width: 100%;
    padding: 10px !important;
    box-sizing: border-box;
    z-index: 1;
    border-bottom: 1px solid #008938;
    padding-left: 10px;
  }

  #second-container {
    padding: 0;
    box-sizing: border-box;
  }

  #second-container > * {
    padding-left: 0px;
    z-index: 2;
  }
</style>

{% endblock %}
