{% extends "layouts/main.html" %}

{% from "components/service-header/macro.njk" import serviceHeader %}

{% set pageName = "New form editor - Defra Forms Designer" %}

{% block header %}
  {{ serviceHeader({
    organisationName: "Defra",
    productName: "Forms Designer",
    homepageLink: "/",
    signOutLink: "/"
  }) }}
{% endblock %}


{% block beforeContent %}
{{ govukBreadcrumbs({
    items: [
      {
        text: "New form editor",
        href: "/new-editor/home.html"
      },
      {
        text: "General pages",
        href: "/new-editor/general/summary.html"
      },
      {
        text: "Page type selection",
        href: "/new-editor/general/listing/home.html"
      }
    ]
  }) }}
{% endblock %}

{% block content %}


<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <span class="govuk-caption-xl">New form editor (general pages)</span>
    <h1 class="govuk-heading-xl">Page re-ordering</h1>
  </div>

  <div class="govuk-grid-column-two-thirds">
    <h2 class="govuk-heading-l">What</h2>
    <p class="govuk-body">
      This page dynamically renders content based on user input or stored data, displaying relevant cards that represent questions or sections in the form. Each card is conditionally displayed, ensuring only necessary elements are shown. For example, cards are rendered if <code>data['questionLabelInputShortText']</code> or other relevant inputs exist.
  </p>

  <h2 class="govuk-heading-m">Structure of Each Card</h2>
  <ul class="govuk-list govuk-list--bullet">
      <li>
          <strong>Wrapper:</strong> Each card is a <code>&lt;li&gt;</code> element wrapped in a <code>gem-c-reorderable-list__item</code> class, making it draggable.
      </li>
      <li>
          <strong>Content Section:</strong>
          <ul class="govuk-list govuk-list--bullet">
              <li>
                  Displays the question title inside a <code>&lt;p&gt;</code> tag with the class <code>gem-c-reorderable-list__title</code>.
              </li>
              <li>
                  Includes a summary card with details like guidance or nested questions using <code>govuk-summary-list</code>, if applicable.
              </li>
          </ul>
      </li>
      <li>
          <strong>Reordering Controls:</strong>
          <ul class="govuk-list govuk-list--bullet">
              <li>Up and Down buttons are implemented using <code>js-reorderable-list-up</code> and <code>js-reorderable-list-down</code> classes.</li>
              <li>A numeric input allows manual position changes.</li>
              <li>Buttons are hidden or disabled where appropriate, such as hiding the "Up" button for the first card.</li>
          </ul>
      </li>
  </ul>

  <h2 class="govuk-heading-m">Special Features for Some Cards</h2>
  <ul class="govuk-list govuk-list--bullet">
      <li>
          <strong>Guidance-Only Card:</strong> Includes guidance text within a summary list. Guidance is truncated if it exceeds 50 characters.
      </li>
      <li>
          <strong>Multi-Question Card:</strong> Displays multiple questions as nested <code>govuk-summary-list__row</code> elements. These cards are identified by <code>data['pageHeadingInputMoreThan1']</code> and display questions in sequential order.
      </li>
  </ul>

  <h2 class="govuk-heading-m">Reordering Functionality</h2>
  <ul class="govuk-list govuk-list--bullet">
      <li>
          <strong>Drag-and-Drop Support:</strong> Uses SortableJS for reordering cards. Custom classes like <code>sortable-ghost</code> and <code>sortable-chosen</code> style the interactions.
      </li>
      <li>
          <strong>Button-Based Movement:</strong> Up and Down buttons allow single-position changes, and event listeners ensure these updates are reflected in the card order.
      </li>
  </ul>

  <h2 class="govuk-heading-m">Additional Features</h2>
  <ul class="govuk-list govuk-list--bullet">
      <li>
          <strong>Page Numbering:</strong> Each card dynamically displays its position using a <code>&lt;span class="page-number"&gt;</code>.
      </li>
      <li>
          <strong>Notification Banner:</strong> Displays a success message upon saving changes.
      </li>
      <li>
          <strong>Conditional Details:</strong> Cards for multi-question or guidance-only types include structured data within nested <code>&lt;dl&gt;</code> and <code>&lt;dd&gt;</code> elements.
      </li>
  </ul>


    <span class="govuk-caption-m govuk-!-margin-bottom-1">Preview</span>
    <div class="iframe-container govuk-!-margin-bottom-6" role="region" aria-labelledby="preview-heading">
      <h2 id="preview-heading" class="govuk-visually-hidden">Preview of the form</h2>
      <iframe
        src="https://defra-forms-mvp-prototype-6c025bd15252.herokuapp.com/redesigntest/reorder/1.html"
        class="iframe-content"
        scrolling="yes"
        frameborder="0"
        title="Form preview"
        marginheight="0"
        marginwidth="0"
        height="500px"
        width="150%"
        allowfullscreen>
      </iframe>
      <div class="iframe-tabs" role="navigation" aria-label="Preview controls">
        <a
          class="govuk-link govuk-link--no-visited-state iframe-tab maximise-button"
          style="border-right: #007f3b 1px solid;"
          href="#"
          role="button"
          aria-label="Maximise preview"
          title="Maximise preview"
          tabindex="0">
          Maximise
        </a>
        <a
          class="govuk-link govuk-link--no-visited-state iframe-tab"
          href="https://defra-forms-mvp-prototype-6c025bd15252.herokuapp.com/redesigntest/listing"
          target="_blank"
          rel="noopener noreferrer"
          aria-label="Open preview in a new tab"
          title="Open preview in a new tab">
          Open in a new tab
        </a>
      </div>
    </div>
</div>

  <div class="govuk-grid-column-one-third">
    <div class="gem-c-related-navigation">
      <h2 id="related-content-heading" class="gem-c-related-navigation__main-heading">
        Related content (links open in a new tab)
      </h2>
      <nav
        role="navigation"
        class="gem-c-related-navigation__nav-section"
        aria-labelledby="related-content-heading">
        <ul class="gem-c-related-navigation__link-list">
          <li class="gem-c-related-navigation__link">
            <a
            class="govuk-link govuk-link gem-c-related-navigation__section-link  govuk-link gem-c-related-navigation__section-link--other"
              href="/apply-apprenticeship"
              rel="noreferrer noopener"
              target="_blank">
              Design history
            </a>
          </li>
          <li class="gem-c-related-navigation__link">
            <a
            class="govuk-link govuk-link gem-c-related-navigation__section-link  govuk-link gem-c-related-navigation__section-link--other"
              href="/redesigntest/reorder/1"
              rel="noreferrer noopener"
              target="_blank">
              View the 'page re-ordering' demo page
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>



<style>
  .link-container {
    display: flex;
    align-items: left;
    margin-bottom: 15px;
  }

  .link-container a {
    padding: 0px 10px;
  }

  .link-container a:first-child {
    border-right: 1px solid #ccc;
    padding-left: 0;
  }


        .govuk-card__flex-container {
    display: flex;
    flex-wrap: wrap;
    gap: 20px!important; /* Spacing between cards */
}

.govuk-card__flex-item {
    flex: 1 1 calc(33.333% - 20px); /* 3 columns with spacing */
    max-width: calc(33.333% - 20px); /* Ensure cards don't grow too wide */
    box-sizing: border-box;
}

@media (max-width: 768px) {
    .govuk-card__flex-item {
        flex: 1 1 calc(50% - 20px); /* 2 columns on medium screens */
        max-width: calc(50% - 20px);
    }
}

@media (max-width: 480px) {
    .govuk-card__flex-item {
        flex: 1 1 100%; /* 1 column on small screens */
        max-width: 100%;
    }
}

.govuk-card--selectable {
    position: relative;
    transition: background-color 0.2s ease, box-shadow 0.2s ease;
}

.govuk-card--selectable:hover {
    background-color: #008938;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.govuk-card--selectable:hover .govuk-card__content h3,
.govuk-card--selectable:hover .govuk-card__content p {
    color: #fff;
}

.govuk-card--selectable a {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    width: 100%;
    z-index: 0;
}

.govuk-card--selectable a:focus {
    outline: 2px solid #ffdd00; /* GOV.UK focus color */
    background-color: initial !important;
}



.gem-c-related-navigation__section-link {
    font-weight: bold;
}

.gem-c-related-navigation__section-link--other {
    font-weight: normal;
}



.gem-c-related-navigation {
    border-top: 2px solid #1d70b8;
    margin-bottom: 60px;
    color: #0b0c0c;
}

.gem-c-related-navigation__main-heading {
    margin-top: 15px;
    margin-bottom: 10px;
    font-family: "GDS Transport",arial,sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    font-weight: 700;
    font-size: 1.1875rem;
    line-height: 1.3157894737;
}

.gem-c-related-navigation__nav-section {
    margin-bottom: 30px;
}

.gem-c-related-navigation__link-list {
    padding: 0;
    margin: 0;
    list-style: none;
    margin-bottom: 1.25em;
}

.gem-c-related-navigation__link {
    list-style-type: none;
    margin-top: 15px;
    font-family: "GDS Transport",arial,sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    font-weight: 400;
    font-size: 1rem;
    line-height: 1.45;
}

@media (min-width: 40.0625em){
  .gem-c-related-navigation__link {
    line-height: 1.28;
  }  }

  .iframe-container {
  border: 5px solid black;
  border-radius: 4px;
  padding: 0;
  overflow: hidden;
  position: relative; /* Ensure tabs stay relative to the container */
}

.iframe-tabs {
  display: flex;
  justify-content: flex-end;
  border-bottom: 1px solid #ccc;
  background-color: #f8f8f8;
  position: absolute; /* Tabs stay positioned above the iframe */
  top: 0;
  left: 0;
  right: 0;
  z-index: 10;
  padding: 10px;
}

.iframe-tab {
  text-align: center;
  padding: 10px;
  font-size: 16px;
  text-decoration: none;
  cursor: pointer;
}

.iframe-tab:hover {
  background-color: #e8e8e8;
}

.iframe-container.fullscreen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100vh;
  z-index: 9999;
  background-color: white;
}

.iframe-container.fullscreen .iframe-tabs {
  position: fixed; /* Keeps tabs at the top in fullscreen mode */
  z-index: 9999;
  background-color: white; /* Ensures visibility */
}

.iframe-container.fullscreen .iframe-content {
  height: calc(100vh - 50px); /* Deduct tab height from viewport */
  width: 100%;
  border: none;
}


</style>

<script>
document.querySelector('.maximise-button').addEventListener('click', function (event) {
  event.preventDefault();

  const iframeContainer = document.querySelector('.iframe-container');
  const iframe = document.querySelector('.iframe-content');
  const button = event.target;

  // Toggle fullscreen mode
  if (iframeContainer.classList.contains('fullscreen')) {
    iframeContainer.classList.remove('fullscreen');
    iframe.style.height = '400px'; // Reset iframe height
    button.textContent = 'Maximise';
  } else {
    iframeContainer.classList.add('fullscreen');
    iframe.style.height = 'calc(100vh - 50px)';
    button.textContent = 'Minimise';
  }
});


</script>

{% endblock %}

