{% extends "layouts/main.html" %}

{% from "components/service-header/macro.njk" import serviceHeader %}

{% block header %}
  {{ serviceHeader({
    serviceName: "Defra form builder",
    pageName: "",
    accountName: "Chris Smith",
    homepageLink: "/",
    signOutLink: "/form-designer-v2/onboarding/sign-out-confirmation",
    navigationItems: [{
      href: "/",
      text: "Form library",
      id: "form-library"
    }],
    activeLinkId: "form-library"
  }) }}
{% endblock %}

{% block pageTitle %}
Form library â€“ {{ serviceName }}
{% endblock %}

{% block content %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <h1 class="govuk-heading-xl">Form library</h1>
  </div>
</div>

<form>
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      <div class="app-field-group">
        <div class="app-field-group__item">
          {{ govukSelect({
            id: "sort",
            name: "sort",
            label: {
              text: "Sort by",
              classes: "app-field-group__label"
            },
            classes: "app-field-group__input",
            items: [
              {
                value: "updated-newest",
                text: "Updated (newest)",
                selected: true
              },
              {
                value: "updated-oldest",
                text: "Updated (oldest)"
              },
              {
                value: "status",
                text: "Status"
              }
            ],
            value: data["sort"]
          }) }}
        </div>
        <div class="app-field-group__item">
          {{ govukButton({
            text: "Sort forms",
            classes: "govuk-button--secondary app-field-group__button"
          }) }}
        </div>
      </div>
    </div>
  </div>
  <div class="govuk-grid-row">
    <div id="search-results" aria-describedby="search-results-heading" class="app-search__results govuk-grid-column-two-thirds-from-desktop">
      <h2 id="search-results-heading" class="govuk-heading-m">
        <span class="govuk-visually-hidden">Search results</span>
        49 forms
      </h2>

      <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">

      {{ govukButton({
        text: "Create new form",
        href: "/form-designer-v2/forms/new-form/form-name"
      }) }}

      {% switch data["sort"] %}
        {% case "updated-newest" %}
          {% set sortBy = "updated.date" %}
          {% set sortReverse = true %}
        {% case "updated-oldest" %}
          {% set sortBy = "updated.date" %}
          {% set sortReverse = false %}
        {% case "status" %}
          {% set sortBy = "status" %}
          {% set sortReverse = false %}
      {% endswitch %}

      {% set formRows = [] %}

      {% for formItem in require("data/form-library.json").items | sort(attribute=sortBy, reverse=sortReverse) %}
        {% set formName %}
          <a href="/form-designer-v2/{{ formItem.path }}" class="govuk-link govuk-link--no-visited-state">
            {{ formItem.name }}
          </a>
        {% endset %}

        {% set formStatus %}
          {% set tagDraft = govukTag({ text: "Draft", classes: "govuk-tag--orange" }) %}
          {% set tagLive = govukTag({ text: "Live", classes: "govuk-tag--green" }) %}

          {% switch formItem.status %}
            {% case "draft" %}
              {{ tagDraft }}
            {% case "draft-live" %}
              {{ tagDraft }} and {{ tagLive }}
            {% case "live" %}
              {{ tagLive }}
          {% endswitch %}
        {% endset %}

        {% set formRows = (formRows.push([
          {
            html: formName
          },
          {
            html: formStatus
          }
        ]), formRows) %}
      {% endfor %}

      {{ govukTable({
        head: [
          {
            text: "Form name"
          },
          {
            text: "Status"
          }
        ],
        rows: formRows
      }) }}

      {{ govukPagination({
        next: {
          href: "#"
        },
        items: [
          {
            number: 1,
            href: "#",
            current: true
          },
          {
            number: 2,
            href: "#"
          },
          {
            ellipsis: true
          },
          {
            number: 5,
            href: "#"
          }
        ]
      }) }}
    </div>
  </div>
</form>
{% endblock %}
