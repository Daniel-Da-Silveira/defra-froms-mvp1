{% extends "layouts/main.html" %}

{% from "components/service-header/macro.njk" import serviceHeader %}

{% set pageName = "Guidance - Apply for a county parish holding number in England" %}

{% block header %}
  {{ serviceHeader({
    organisationName: "Defra",
    productName: "Forms Designer",
    serviceName: "",
    containerClasses: containerClasses,
    accountName: "Chris Smith",
    homepageLink: "/",
    signOutLink: "/onboarding/sign-out-confirmation",
    navigationItems: [
      {
        href: "/library.html",
        text: "Forms library",
        id: "library"
      },
      {
        href: "/cph-overview/draft/complete-clean.html",
        text: "Overview",
        id: "overview"
      },
      {
        href: "/editor-pets/0",
        text: 'Editor',
        id: 'editor'
      }
    ],
    activeLinkId: "editor"
  }) }}
{% endblock %}

{% block content %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-one-half">
      <div class="govuk-summary-card" style="border-left: solid 4px #008938!important; outline-color: transparent; border: 1px solid transparent;">
        <div class="govuk-summary-card__title-wrapper">
          <h2 class="govuk-summary-card__title">
            Question 1
          </h2>
          <ul class="govuk-summary-card__actions">
            <li class="govuk-summary-card__action">
              <a class="govuk-link" href="#">Delete<span class="govuk-visually-hidden">
                  of University of Gloucestershire (University of Gloucestershire)</span></a>
            </li>
            <li class="govuk-summary-card__action">
              <a class="govuk-link" href="#">Preview<span class="govuk-visually-hidden">
                  from University of Gloucestershire (University of Gloucestershire)</span></a>
            </li>
          </ul>
        </div>
        <hr class="govuk-section-break govuk-section-break--visible" style="width: auto;">
        <div class="govuk-summary-card__content" style="background-color: #f3f2f1;">
          <dl class="govuk-summary-list">
            <div class="govuk-summary-list__row">
              <dt class="govuk-summary-list__key">
                Edit question
              </dt>
              <dd class="govuk-summary-list__value">
                <div class="govuk-form-group">
                  <h1 class="govuk-label-wrapper">
                    <label id="event-name" for="event-name" class="govuk-label govuk-label--m editable" contenteditable="true" aria-label="Edit the event name label" style="background-color: white; padding: 10px;">
                      Write your question
                    </label>
                  </h1>
                  <div id="event-name-hint" class="govuk-hint editable" contenteditable="true" aria-label="Edit the hint for the event name" style="background-color: white; padding: 10px; margin-top:10px;">
                    Write hint text (optional)
                  </div>
                  <input class="govuk-input" id="short-answer" name="shortAnswer" type="text" readonly="readonly">
                </div>
              </dd>
            </div>

            <div class="govuk-summary-list__row">
              <dt class="govuk-summary-list__key">
                Basic settings
              </dt>
              <dd class="govuk-summary-list__value">
                <div class="govuk-form-group">
                  <fieldset class="govuk-fieldset">
                    <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">
                      <h1 class="govuk-fieldset__heading govuk-!-display-none">
                        Basics
                      </h1>
                    </legend>
                    <div class="govuk-checkboxes govuk-checkboxes--small e" data-module="govuk-checkboxes">
                      <div class="govuk-checkboxes__item">
                        <input class="govuk-checkboxes__input" id="optional" name="optional" type="checkbox" value="optional">
                        <label class="govuk-label govuk-checkboxes__label" for="optional">
                          Optional
                        </label>
                      </div>
                      <div class="govuk-checkboxes__item">
                        <input class="govuk-checkboxes__input" id="long-answer" name="longAnswer" type="checkbox" value="longAnswer">
                        <label class="govuk-label govuk-checkboxes__label" for="long-answer">
                          Long answer
                        </label>
                      </div>
                    </div>
                  </fieldset>
                </div>
              </dd>
            </div>

            <div class="govuk-summary-list__row">
              <dt class="govuk-summary-list__key">
                Error messages
              </dt>
              <dd class="govuk-summary-list__value">
                <div class="govuk-form-group">
                  <h1 class="govuk-label-wrapper">
                    <label class="govuk-label govuk-label--s" for="short-label">
                      Enter a short label
                    </label>
                  </h1>
                  <div id="short-label-hint" class="govuk-hint">
                    Short labels are used in error messages, such as ‘Enter a
                    <span style="outline: 3px black dotted; padding: 1.2px;">date of birth</span>’.
                  </div>
                  <input class="govuk-input govuk-input--width-20" id="short-label" name="shortLabel" type="text">
                </div>

                <details class="govuk-details">
                  <summary class="govuk-details__summary">
                    <span class="govuk-details__summary-text">
                      View error message with short label
                    </span>
                  </summary>
                  <div class="govuk-details__text">
                    <div class="govuk-form-group govuk-form-group--error">
                      <h1 class="govuk-label-wrapper">
                        <label class="govuk-label govuk-label--m" for="event-name-error">
                          Your question
                        </label>
                      </h1>
                      <div id="event-name-error-hint" class="govuk-hint">
                        Your hint text if you added any
                      </div>
                      <p id="event-name-error" class="govuk-error-message">
                        <span class="govuk-visually-hidden">Error:</span>
                        Enter
                      </p>
                      <input class="govuk-input govuk-input--error" id="event-name-error-input" name="eventNameError" type="text" aria-describedby="event-name-error-hint event-name-error-message">
                    </div>
                  </div>
                </details>

              </dd>
            </div>

            <div class="govuk-summary-list__row">
              <dt class="govuk-summary-list__key">
                Rules
              </dt>
              <dd class="govuk-summary-list__value"></dd>
            </div>
          </dl>
        </div>
      </div>
    </div>

    <div class="govuk-grid-column-one-half" style=" outline: solid 1px #f3f2f1;
            height: 100%;
            position: sticky;
            top: 0;  ">
      {% from "govuk/components/header/macro.njk" import govukHeader %}

      {{ govukHeader({
        homepageUrl: "#",
        serviceName: "Apply for a county parish holding certificate",
        serviceUrl: "#"
      }) }}
      <!-- Existing Date Input Field -->
      {% from "govuk/components/date-input/macro.njk" import govukDateInput %}
      <div>
        {{ govukTag({
          text: "Preview of question",
          classes: "govuk-tag--yellow govuk-!-margin-bottom-2 govuk-!-margin-top-2"
        }) }}
      </div>

      <!-- New Fieldset with Dynamic Legend -->
      <form>
        <fieldset class="govuk-fieldset">
          <legend class="govuk-fieldset__legend govuk-fieldset__legend--l" id="dynamic-legend">
            Question label
          </legend>
          <div class="govuk-form-group">
            <div id="passport-issued-hint" class="govuk-hint">For example, 27 3 2007</div>
            <div id="passport-expiry" class="govuk-date-input" data-module="govuk-date-input">
              <div class="govuk-date-input__item">
                <div class="govuk-form-group">
                  <label class="govuk-label govuk-date-input__label" for="passport-expiry-day">Day</label>
                  <input class="govuk-input govuk-date-input__input govuk-input--width-2" id="passport-expiry-day" name="passport-expiry-day" type="text" pattern="[0-9]*">
                </div>
              </div>
              <div class="govuk-date-input__item">
                <div class="govuk-form-group">
                  <label class="govuk-label govuk-date-input__label" for="passport-expiry-month">Month</label>
                  <input class="govuk-input govuk-date-input__input govuk-input--width-2" id="passport-expiry-month" name="passport-expiry-month" type="text" pattern="[0-9]*">
                </div>
              </div>
              <div class="govuk-date-input__item">
                <div class="govuk-form-group">
                  <label class="govuk-label govuk-date-input__label" for="passport-expiry-year">Year</label>
                  <input class="govuk-input govuk-date-input__input govuk-input--width-4" id="passport-expiry-year" name="passport-expiry-year" type="text" pattern="[0-9]*">
                </div>
              </div>
            </div>
          </div>
        </fieldset>
      </form>

      <details class="govuk-details">
        <summary class="govuk-details__summary">
          <span class="govuk-details__summary-text">
            View error messages
          </span>
        </summary>
        <div class="govuk-details__text">
          <div class="govuk-form-group govuk-form-group--error">
            <fieldset class="govuk-fieldset" role="group" aria-describedby="passport-issued-hint passport-issued-error">
              <legend class="govuk-fieldset__legend govuk-fieldset__legend--l">
                <h1 class="govuk-fieldset__heading">
                  When was your passport issued?
                </h1>
              </legend>
              <div id="passport-issued-hint" class="govuk-hint">
                For example, 27 3 2007
              </div>
              <p id="passport-issued-error" class="govuk-error-message">
                <span class="govuk-visually-hidden">Error:</span>
                Enter
                <span id="error-dynamic-text">date of birth</span>
              </p>
              <div class="govuk-date-input" id="passport-issued">
                <div class="govuk-date-input__item">
                  <div class="govuk-form-group">
                    <label class="govuk-label govuk-date-input__label" for="passport-issued-day">
                      Day
                    </label>
                    <input class="govuk-input govuk-date-input__input govuk-input--width-2 govuk-input--error" id="passport-issued-day" name="passport-issued-day" type="text" value="6" inputmode="numeric">
                  </div>
                </div>
                <div class="govuk-date-input__item">
                  <div class="govuk-form-group">
                    <label class="govuk-label govuk-date-input__label" for="passport-issued-month">
                      Month
                    </label>
                    <input class="govuk-input govuk-date-input__input govuk-input--width-2 govuk-input--error" id="passport-issued-month" name="passport-issued-month" type="text" value="3" inputmode="numeric">
                  </div>
                </div>
                <div class="govuk-date-input__item">
                  <div class="govuk-form-group">
                    <label class="govuk-label govuk-date-input__label" for="passport-issued-year">
                      Year
                    </label>
                    <input class="govuk-input govuk-date-input__input govuk-input--width-4 govuk-input--error" id="passport-issued-year" name="passport-issued-year" type="text" value="2076" inputmode="numeric">
                  </div>
                </div>
              </div>
            </fieldset>
          </div>
        </div>
      </details>

    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var renderErrorMessageButton = document.getElementById('render-error-message');
      var shortLabelInput = document.getElementById('short-label');
      var eventNameLabel = document.getElementById('event-name');
      var eventNameHint = document.getElementById('event-name-hint');
      var longAnswerCheckbox = document.getElementById('long-answer');
      var optionalCheckbox = document.getElementById('optional');
      var shortAnswerInput = document.getElementById('short-answer');

      if (renderErrorMessageButton) {
        renderErrorMessageButton.addEventListener('click', function () {
          const eventName = eventNameLabel.textContent;
          const eventHint = eventNameHint.textContent;

          const newHTML = `
            <div class="govuk-form-group govuk-form-group--error">
              <h1 class="govuk-label-wrapper">
                <label id="event-name" for="event-name" class="govuk-label govuk-label--l" style="background-color: white; padding: 10px;">
                  ${eventName}
                </label>
              </h1>
              <div id="event-name-hint" class="govuk-hint" style="background-color: white; padding: 10px; margin-top:10px;">
                ${eventHint}
              </div>
              <div id="event-name-error-message" class="govuk-error-message">
                <span class="govuk-visually-hidden">Error:</span>
                <p>There is a problem with the event name</p>
              </div>
              <input class="govuk-input govuk-input--error" id="short-answer" name="shortAnswer" type="text">
            </div>
          `;

          const formGroupContainer = document.querySelector('.govuk-form-group');
          formGroupContainer.innerHTML = newHTML;
        });
      }

      function updateErrorMessage() {
        var shortLabelText = shortLabelInput
          .value
          .trim();
        var eventNameError = document.getElementById('event-name-error-message');
        if (shortLabelText) {
          eventNameError.innerHTML = `<span class="govuk-visually-hidden">Error:</span> Enter ${shortLabelText}`;
        } else {
          eventNameError.innerHTML = `<span class="govuk-visually-hidden">Error:</span> Enter an event name`;
        }
      }

      shortLabelInput.addEventListener('input', updateErrorMessage);

      longAnswerCheckbox.addEventListener('change', function () {
        if (longAnswerCheckbox.checked) {
          var textarea = document.createElement('textarea');
          textarea.className = 'govuk-textarea';
          textarea.id = 'short-answer';
          textarea.name = 'shortAnswer';
          textarea.setAttribute('readonly', true);

          shortAnswerInput
            .parentNode
            .replaceChild(textarea, shortAnswerInput);
          shortAnswerInput = textarea; // Update reference
        } else {
          var input = document.createElement('input');
          input.className = 'govuk-input';
          input.id = 'short-answer';
          input.name = 'shortAnswer';
          input.type = 'text';
          input.setAttribute('readonly', true);

          shortAnswerInput
            .parentNode
            .replaceChild(input, shortAnswerInput);
          shortAnswerInput = input; // Update reference
        }
      });

      optionalCheckbox.addEventListener('change', function () {
        var currentText = eventNameLabel
          .textContent
          .trim();
        if (optionalCheckbox.checked) {
          if (!currentText.endsWith(' (optional)')) {
            eventNameLabel.textContent = currentText + ' (optional)';
          }
        } else {
          if (currentText.endsWith(' (optional)')) {
            eventNameLabel.textContent = currentText.slice(0, - ' (optional)'.length);
          }
        }
      });

      var originalLabelText = eventNameLabel
        .textContent
        .trim();
      if (optionalCheckbox.checked) {
        eventNameLabel.textContent = originalLabelText + ' (optional)';
      } else {
        eventNameLabel.textContent = originalLabelText;
      }
    });

    document.addEventListener('DOMContentLoaded', function () {
      var eventNameLabel = document.getElementById('question-label');
      var optionalCheckbox = document.getElementById('optional');
      var longAnswerCheckbox = document.getElementById('long-answer');
      var shortAnswerInput = document.getElementById('short-answer');
      var shortLabelInput = document.getElementById('short-label');
      var eventNameErrorParagraph = document.getElementById('event-name-error');

      // Function to update error message
      function updateErrorMessage() {
        var shortLabelValue = shortLabelInput
          .value
          .trim();
        if (shortLabelValue) {
          eventNameErrorParagraph.innerHTML = `<span class="govuk-visually-hidden">Error:</span> Enter ${shortLabelValue}`;
        } else {
          eventNameErrorParagraph.innerHTML = `<span class="govuk-visually-hidden">Error:</span> Enter`;
        }
      }

      // Event listener for short label input field
      shortLabelInput.addEventListener('input', updateErrorMessage);

      // Existing logic for checkboxes
      optionalCheckbox.addEventListener('change', function () {
        var currentText = eventNameLabel
          .textContent
          .trim();
        if (optionalCheckbox.checked) {
          if (!currentText.endsWith(' (optional)')) {
            eventNameLabel.textContent = currentText + ' (optional)';
          }
        } else {
          if (currentText.endsWith(' (optional)')) {
            eventNameLabel.textContent = currentText.slice(0, - ' (optional)'.length);
          }
        }
      });

      longAnswerCheckbox.addEventListener('change', function () {
        if (longAnswerCheckbox.checked) {
          var textarea = document.createElement('textarea');
          textarea.className = 'govuk-textarea';
          textarea.id = 'short-answer';
          textarea.name = 'shortAnswer';
          textarea.setAttribute('readonly', true);

          shortAnswerInput
            .parentNode
            .replaceChild(textarea, shortAnswerInput);
          shortAnswerInput = textarea; // Update reference
        } else {
          var input = document.createElement('input');
          input.className = 'govuk-input';
          input.id = 'short-answer';
          input.name = 'shortAnswer';
          input.type = 'text';
          input.setAttribute('readonly', true);

          shortAnswerInput
            .parentNode
            .replaceChild(input, shortAnswerInput);
          shortAnswerInput = input; // Update reference
        }
      });
    });
  </script>

  <style>
    .sticky-form-group {
      position: -webkit-sticky;
      /* For Safari */
      position: sticky;
      top: 0;
      /* Stick to the top of the viewport */
      background-color: #f3f2f1;
      /* Background color to ensure it’s readable */
      z-index: 1000;
      /* Keeps it above other content */
      border-bottom: 3px solid #ddd;
      /* Optional: Border for visual separation */
      padding: 10px;
      /* Optional: Padding for spacing */
      box-shadow: 0 1px 2.5px rgba(0, 0, 0, 0.15);
      /* Adds a subtle shadow */
    }

    .editable:focus {
      outline: 3px solid #fd0;
      outline-offset: 0;
      box-shadow: inset 0 0 0 2px;
    }

    .horizontal-block {
      display: flex;
      align-items: center;
      border: 2px solid #1d70b8;
      /* GOV.UK blue */
      padding: 10px;
      margin: 10px 0;
    }

    .horizontal-block__text {
      flex-grow: 1;
      font-size: 1rem;
    }

    .horizontal-block__icon {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 24px;
      height: 24px;
      border: 2px solid #1d70b8;
      /* GOV.UK blue */
      border-radius: 50%;
      color: #1d70b8;
      font-weight: bold;
      cursor: pointer;
    }

    .tooltip-container {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      padding: var(--ic-space-md);
    }

    /* Chris Harding (14.06.23) - Styling fixes to the 'Show filters' button to address the misalignment that can occur for users viewing between 641px and 852px width */
    @media (min-width: 641px) {

      .defra-filter--open .govuk-button {
        height: 70px;
        padding-bottom: 30px;
      }

      .defra-filter--content {
        margin-top: -10px;
      }

    }

    @media (min-width: 693px) and (max-width: 768px) {
      .defra-filter--open .defra-filter__icon {
        top: 25px !important;
      }
    }

    @media (min-width: 641px) and (max-width: 692px) {

      .defra-filter--action .govuk-button {
        padding-right: 20px;
      }

      .defra-filter__icon {
        display: none;
      }

    }

    #defra-filter--button {
      margin-top: inherit;
    }
    /* This is a unique pixel width for 'dashboard-submitted.html' (e.g. users with >1 submitted applications) */
    @media (min-width: 641px) and (max-width: 852px) {
      #defra-filter--button {
        margin-top: 55px;
      }
    }
    @media (min-width: 853px) {
      #defra-filter--button {
        margin-top: 30px;
      }
    }

    /* Chris Harding (26.08.22) - Keep consistent spacing inside the bottom of the tabs panel (2xpx) */
    .search-and-filters-no-results-list {
      margin-bottom: 0;
    }
    /* FILTERS AND SEARCH (END) */

    .defra-filter--action .defra-filter__icon {
      position: absolute;
      top: 50%;
      right: 15px;
      width: 16px;
      height: 16px;
      margin-top: -8px;
    }
    .defra-filter--action .defra-filter__icon:before {
      content: "";
      -webkit-box-sizing: border-box;
      box-sizing: border-box;
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      width: 25%;
      height: 25%;
      margin: auto;
      border: 2px solid transparent;
      background-color: #0b0c0c;
    }
    .defra-filter--action .defra-filter__icon:after {
      content: "";
      -webkit-box-sizing: border-box;
      box-sizing: border-box;
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      width: 25%;
      height: 25%;
      margin: auto;
      border: 2px solid transparent;
      background-color: #0b0c0c;
    }
    .defra-filter--action .defra-filter__icon:before {
      width: 100%;
    }
    .defra-filter--action .defra-filter__icon:after {
      height: 100%;
    }

    .defra-filter--box {
      margin-top: 10px;
      /* Adjust spacing as needed */
      padding: 15px;
      border: 1px solid #ccc;
      /* Light grey border */
      background-color: #f9f9f9;
      /* Light grey background */
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      /* Optional shadow */
      position: relative;
      /* Ensures the box appears below the button */
      top: 100%;
      /* Places the box below the button */
      left: 0;
      right: 0;
    }

    .hidden {
      display: none;
    }

    .close-icon,
    .plus-icon {
      transition: transform 0.3s;
    }

    .close-icon {
      transform: rotate(45deg);
      /* Rotate the X icon to create a cross */
    }
  </style>
{% endblock %}